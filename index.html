<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±èª B1â†’B2 é€²éšå­¸ç¿’å¹³å°</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:Arial,sans-serif;background:#FFFEF8;color:#3D3D3D;line-height:1.6}
        header{background:linear-gradient(135deg,#F5E8D9,#FDD9BE);padding:20px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;box-shadow:0 2px 4px rgba(0,0,0,0.05)}
        h1{font-size:24px;color:#A89968;margin:0}
        .header-right{display:flex;gap:15px;align-items:center}
        button{background:#F5C197;color:#3D3D3D;border:none;padding:10px 15px;border-radius:6px;cursor:pointer;font-size:14px;font-weight:500;transition:all 0.3s}
        button:hover{background:#F0B8A8}
        .container{max-width:1200px;margin:0 auto;padding:20px}
        .section{background:#F5E8D9;margin:20px 0;padding:25px;border-radius:10px;border-left:5px solid #F5C197;box-shadow:0 2px 8px rgba(0,0,0,0.05)}
        .section h2{color:#A89968;margin-bottom:20px;font-size:22px}
        .tabs{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}
        .tab{padding:12px 18px;background:#FDD9BE;color:#3D3D3D;border:none;border-radius:6px;cursor:pointer;font-weight:500;transition:all 0.3s}
        .tab.active{background:#F5C197;color:white}
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:15px}
        .stat-card{background:#FFF5E6;padding:15px;border-radius:8px;border:2px solid #FDD9BE;text-align:center}
        .stat-number{font-size:28px;font-weight:bold;color:#F5C197}
        .stat-label{font-size:12px;color:#6B6B6B;margin-top:5px}
        .learning-blocks{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:15px}
        .learning-block{background:#FFF5E6;padding:15px;border-radius:8px;border-left:4px solid #F0B8A8}
        .block-title{font-weight:bold;color:#A89968;margin-bottom:8px;font-size:14px}
        .block-content{color:#6B6B6B;font-size:13px;line-height:1.5}
        .vocab-card{background:#FFF5E6;padding:12px;border-radius:8px;margin-bottom:10px;border-left:4px solid #F0B8A8}
        .vocab-word{font-size:15px;font-weight:bold;color:#A89968;margin-bottom:3px}
        .vocab-pronunciation{color:#9B8B7E;font-size:11px;margin-bottom:3px}
        .vocab-meaning{color:#3D3D3D;margin-top:4px;font-size:13px;margin-bottom:3px}
        .vocab-example{color:#6B6B6B;font-size:11px;font-style:italic;margin-top:4px}
        .play-btn{background:#F0B8A8;color:white;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;font-size:11px;margin-top:6px}
        .play-btn:hover{background:#F5C197}
        .grammar-q{background:#FFF5E6;padding:12px;border-radius:8px;margin-bottom:12px;border-left:4px solid #F0B8A8}
        .q-text{font-weight:bold;color:#3D3D3D;margin-bottom:10px;font-size:13px}
        .options{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:8px;margin-bottom:8px}
        .opt-btn{padding:8px;background:#FDD9BE;color:#3D3D3D;border:2px solid transparent;border-radius:6px;cursor:pointer;font-size:12px}
        .opt-btn:hover{border-color:#F5C197}
        .opt-btn.correct{background:#C9A876;color:white}
        .explain{background:#F9F6F0;padding:8px;border-radius:6px;margin-top:6px;font-size:11px;color:#6B6B6B;display:none}
        .explain.show{display:block}
        .writing-ex{background:#FFF5E6;padding:12px;border-radius:8px;border-left:4px solid #F0B8A8;margin-bottom:15px}
        .ex-label{font-weight:bold;color:#A89968;margin-bottom:8px;font-size:14px}
        .ex-content{color:#3D3D3D;margin-bottom:10px;font-size:13px}
        .ex-hint{background:#F9F6F0;padding:6px;border-radius:6px;margin-bottom:10px;font-size:11px;color:#6B6B6B}
        textarea{width:100%;min-height:100px;padding:10px;border:2px solid #FDD9BE;border-radius:6px;font-size:13px;color:#3D3D3D;margin-bottom:8px;font-family:Arial,sans-serif}
        textarea:focus{outline:none;border-color:#F5C197}
        .word-count{font-size:11px;color:#6B6B6B;margin-bottom:10px}
        .submit-btn{background:#C9A876;color:white;padding:10px 20px;font-weight:bold}
        .submit-btn:hover{background:#A89968}
        .feedback{background:#F9F6F0;padding:10px;border-radius:6px;margin-top:10px;font-size:12px;display:none}
        .feedback.show{display:block}
        .modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center}
        .modal.show{display:flex}
        .modal-content{background:#F5E8D9;padding:25px;border-radius:10px;max-width:400px;width:90%;box-shadow:0 4px 20px rgba(0,0,0,0.3)}
        .modal-content h3{color:#A89968;margin-bottom:15px;font-size:18px}
        .modal-content input{width:100%;padding:10px;margin-bottom:12px;border:2px solid #FDD9BE;border-radius:6px;font-size:13px}
        .modal-btns{display:flex;gap:10px;justify-content:flex-end}
        .user-list{max-height:150px;overflow-y:auto;margin-bottom:12px}
        .user-item{padding:8px;background:#FFF5E6;border-radius:6px;margin-bottom:6px;cursor:pointer;font-size:13px;border-left:3px solid #F0B8A8}
        .user-item:hover{background:#FDD9BE}
        @media (max-width:768px){h1{font-size:20px}.learning-blocks{grid-template-columns:1fr}.stats-grid{grid-template-columns:repeat(2,1fr)}}
    </style>
</head>
<body>
<header>
    <div><h1>ğŸŒ è‹±èª B1â†’B2 é€²éšå­¸ç¿’å¹³å°</h1></div>
    <div class="header-right">
        <span id="currentUser" style="font-weight:bold;color:#A89968;font-size:14px">æœªç™»å…¥</span>
        <button onclick="openUserModal()">åˆ‡æ›ç”¨æˆ¶</button>
    </div>
</header>

<div class="container">
    <div class="section">
        <h2>ğŸ“Š å­¸ç¿’é€²åº¦çµ±è¨ˆ</h2>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-number" id="d1">0</div><div class="stat-label">å­¸ç¿’å¤©æ•¸</div></div>
            <div class="stat-card"><div class="stat-number" id="d2">0</div><div class="stat-label">é€£çºŒå¤©æ•¸</div></div>
            <div class="stat-card"><div class="stat-number" id="d3">0</div><div class="stat-label">å­¸ç¿’å–®å­—</div></div>
            <div class="stat-card"><div class="stat-number" id="d4">0</div><div class="stat-label">å®Œæˆå¯«ä½œ</div></div>
        </div>
    </div>

    <div class="section">
        <h2>â±ï¸ 5-5-5 æ—¥å¸¸å­¸ç¿’æ–¹æ³•</h2>
        <div class="learning-blocks">
            <div class="learning-block"><div class="block-title">ğŸ‘‚ è½åŠ›è¼¸å…¥ (5åˆ†é˜)</div><div class="block-content">â€¢ æ’­æ”¾è‹±æ–‡åª’é«”<br>â€¢ è½åŠ›ç·´ç¿’<br>â€¢ å­—å¹•è·Ÿè®€</div></div>
            <div class="learning-block"><div class="block-title">ğŸ—£ï¸ å£èªªè¼¸å‡º (5åˆ†é˜)</div><div class="block-content">â€¢ è·Ÿè®€ç·´ç¿’<br>â€¢ è‡ªç”±æ¼”è¬›<br>â€¢ å°è©±ç·´ç¿’</div></div>
            <div class="learning-block"><div class="block-title">âœï¸ å¯«ä½œæ•´åˆ (5åˆ†é˜)</div><div class="block-content">â€¢ å¾®å¯«ä½œ<br>â€¢ å¥å­çµ„ç¹”<br>â€¢ æ®µè½ç·´ç¿’</div></div>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ“… æ¯é€±å­¸ç¿’ä¸»é¡Œè¨ˆåŠƒ</h2>
        <div class="learning-blocks">
            <div class="learning-block"><div class="block-title">æ˜ŸæœŸä¸€</div><div class="block-content">å•†å‹™è‹±æ–‡ - Emailã€æœƒè­°ç”¨èª</div></div>
            <div class="learning-block"><div class="block-title">æ˜ŸæœŸäºŒ</div><div class="block-content">æ—¥å¸¸å°è©± - è³¼ç‰©ã€é¤å»³ã€ç”Ÿæ´»</div></div>
            <div class="learning-block"><div class="block-title">æ˜ŸæœŸä¸‰</div><div class="block-content">é–±è®€æ—¥ - æ–°èã€éƒ¨è½æ ¼ã€æ–‡ç« </div></div>
            <div class="learning-block"><div class="block-title">æ˜ŸæœŸå››</div><div class="block-content">å¯«ä½œé›†ä¸­ - çŸ­æ–‡ã€è«–æ–‡ã€æ®µè½</div></div>
            <div class="learning-block"><div class="block-title">æ˜ŸæœŸäº”</div><div class="block-content">å£èªªç·´ç¿’ - æ¼”è¬›ã€è¨è«–ã€è¾¯è«–</div></div>
            <div class="learning-block"><div class="block-title">æ˜ŸæœŸå…­</div><div class="block-content">æ··åˆè¤‡ç¿’ - å„é …æŠ€èƒ½æ•´åˆ</div></div>
            <div class="learning-block"><div class="block-title">æ˜ŸæœŸæ—¥</div><div class="block-content">é€±è©•æ¸¬ - é€²åº¦æª¢è¦–èˆ‡èª¿æ•´</div></div>
        </div>
    </div>

    <div class="section">
        <h2>ğŸ“š B2 é€²éšè©å½™å­¸ç¿’</h2>
        <div id="vc"></div>
    </div>

    <div class="section">
        <h2>ğŸ“– B2 é€²éšæ–‡æ³•å­¸ç¿’</h2>
        <div id="gt"></div>
        <div id="gc"></div>
    </div>

    <div class="section">
        <h2>âœï¸ å¯«ä½œç·´ç¿’å·¥ä½œå€</h2>
        <div class="tabs" id="wt">
            <button class="tab active" data-index="0">ç´šåˆ¥1ï¼šå¥å­çµ„åˆ</button>
            <button class="tab" data-index="1">ç´šåˆ¥2ï¼šæ®µè½å¯«ä½œ</button>
            <button class="tab" data-index="2">ç´šåˆ¥3ï¼šçŸ­æ–‡å‰µä½œ</button>
        </div>
        <div id="wc"></div>
    </div>
</div>

<div class="modal" id="um">
    <div class="modal-content">
        <h3>ç”¨æˆ¶ç®¡ç†</h3>
        <div class="user-list" id="ul"></div>
        <input id="nui" placeholder="è¼¸å…¥æ–°ç”¨æˆ¶åç¨±">
        <div class="modal-btns">
            <button onclick="closeUserModal()">å–æ¶ˆ</button>
            <button onclick="addNewUser()" class="submit-btn">å‰µå»ºç”¨æˆ¶</button>
        </div>
    </div>
</div>

<script>
    // ========= B2 è©å½™ç¤ºæ„ï¼Œå¯ä¹‹å¾Œè‡ªè¡Œæ“´å…… =========
    const vocabData = [
        {
            word: 'significant',
            pronunciation: '/sÉªÉ¡ËˆnÉªf.Éª.kÉ™nt/',
            meaning: 'é‡è¦çš„ï¼›é¡¯è‘—çš„',
            example: 'There has been a significant improvement in her English.'
        },
        {
            word: 'challenge',
            pronunciation: '/ËˆtÊƒÃ¦l.ÉªndÊ’/',
            meaning: 'æŒ‘æˆ°ï¼›é›£é¡Œ',
            example: 'Preparing students for B2 exams can be a real challenge.'
        },
        {
            word: 'efficient',
            pronunciation: '/ÉªËˆfÉªÊƒ.É™nt/',
            meaning: 'æœ‰æ•ˆç‡çš„',
            example: 'This learning platform helps students study in an efficient way.'
        }
    ];

    // ========= æ–‡æ³•æ•¸æ“šï¼ˆå¾ Wen-Fa-Shu-Ju.docx åŒ¯å…¥æ‘˜è¦ç‰ˆï¼‰ =========
    const grammarData = [
        {
            topic: 'ç¾åœ¨å®Œæˆå¼ vs éå»å®Œæˆå¼',
            questions: [
                { question: 'I _____ in this city for 10 years.',
                  options: ['lived', 'have lived', 'had lived', 'was living'],
                  correct: 1,
                  explanation: 'ç¾åœ¨å®Œæˆå¼è¡¨ç¤ºå¾éå»åˆ°ç¾åœ¨çš„æŒçºŒç‹€æ…‹ã€‚' },
                { question: 'Before he arrived, they _____ the meeting.',
                  options: ['started', 'have started', 'had started', 'were starting'],
                  correct: 2,
                  explanation: 'éå»å®Œæˆå¼è¡¨ç¤ºåœ¨å¦ä¸€å€‹éå»å‹•ä½œä¹‹å‰ç™¼ç”Ÿçš„äº‹ã€‚' }
            ]
        },
        {
            topic: 'è™›æ“¬èªæ°£',
            questions: [
                { question: 'If I _____ you, I would accept the offer.',
                  options: ['was', 'were', 'am', 'had been'],
                  correct: 1,
                  explanation: 'è™›æ“¬èªæ°£ä¸­ä½¿ç”¨ wereï¼Œå³ä½¿ä¸»èªæ˜¯å–®æ•¸ã€‚' },
                { question: 'If you _____ harder, you would have passed.',
                  options: ['studied', 'had studied', 'study', 'would study'],
                  correct: 1,
                  explanation: 'ç¬¬ä¸‰é¡æ¢ä»¶å¥ç”¨éå»å®Œæˆå¼ã€‚' }
            ]
        },
        {
            topic: 'è¢«å‹•èªæ…‹',
            questions: [
                { question: 'The project _____ by the team next week.',
                  options: ['is completed', 'will be completed', 'was completed', 'has been completed'],
                  correct: 1,
                  explanation: 'æœªä¾†æ™‚è¢«å‹•èªæ…‹ä½¿ç”¨ will be + past participleã€‚' },
                { question: 'The report _____ yesterday.',
                  options: ['should submit', 'should be submitted', 'should submitted', 'submit'],
                  correct: 1,
                  explanation: 'æƒ…æ…‹å‹•è© + be + past participleã€‚' }
            ]
        }
        // å¯ä¾éœ€è¦å†æŠŠ docx å…¶é¤˜é¡Œç›®è£œé€²ä¾†
    ];

    // ========= å¯«ä½œç·´ç¿’é¡Œåº«ï¼ˆå¾ Wen-Fa-Shu-Ju.docx åŒ¯å…¥ï¼‰ =========
    const writingExercisesBank = {
        level1: [
            { question: 'Combine: "She finished her homework. She went to play." Answer should use a conjunction.',
              hint: 'Use "after" or "before"' },
            { question: 'Combine: "He studied hard. He passed the exam." Answer should use a conjunction.',
              hint: 'Use "so" or "because"' },
            { question: 'Combine: "The weather was bad. We went outside anyway." Answer should use a conjunction.',
              hint: 'Use "although" or "even though"' }
        ],
        level2: [
            { topic: 'My favorite hobby',
              keywords: 'enjoy, practice, improve, passion' },
            { topic: 'A memorable travel experience',
              keywords: 'memorable, experience, learned, cultural' },
            { topic: 'The role of technology in education',
              keywords: 'technology, learning, improve, access' }
        ],
        level3: [
            { topic: 'The importance of learning English in the digital age' },
            { topic: 'How to balance work and personal life' },
            { topic: 'The impact of social media on society' }
        ]
    };

    // ========= ç”¨æˆ¶ / é€²åº¦ localStorage =========
    const STORAGE_KEY = 'b1b2_users_v1';

    function loadUsers() {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return { current: null, users: {} };
        try {
            return JSON.parse(raw);
        } catch (e) {
            return { current: null, users: {} };
        }
    }

    function saveUsers(data) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    let userState = loadUsers();

    function updateCurrentUserDisplay() {
        const span = document.getElementById('currentUser');
        span.textContent = userState.current ? userState.current : 'æœªç™»å…¥';
    }

    function openUserModal() {
        renderUserList();
        document.getElementById('um').classList.add('show');
    }

    function closeUserModal() {
        document.getElementById('um').classList.remove('show');
    }

    function renderUserList() {
        const ul = document.getElementById('ul');
        ul.innerHTML = '';
        const names = Object.keys(userState.users);
        if (names.length === 0) {
            ul.innerHTML = '<div style="font-size:12px;color:#6B6B6B">ç›®å‰æ²’æœ‰ç”¨æˆ¶ï¼Œè«‹å…ˆå»ºç«‹ä¸€ä½ã€‚</div>';
            return;
        }
        names.forEach(name => {
            const div = document.createElement('div');
            div.className = 'user-item';
            div.textContent = name;
            div.onclick = () => {
                userState.current = name;
                saveUsers(userState);
                updateCurrentUserDisplay();
                closeUserModal();
                loadUserProgress();
            };
            ul.appendChild(div);
        });
    }

    function addNewUser() {
        const input = document.getElementById('nui');
        const name = input.value.trim();
        if (!name) return;
        if (!userState.users[name]) {
            userState.users[name] = {
                days: 0,
                streak: 0,
                words: 0,
                writings: 0
            };
        }
        userState.current = name;
        saveUsers(userState);
        input.value = '';
        updateCurrentUserDisplay();
        renderUserList();
        loadUserProgress();
    }

    function loadUserProgress() {
        const d1 = document.getElementById('d1');
        const d2 = document.getElementById('d2');
        const d3 = document.getElementById('d3');
        const d4 = document.getElementById('d4');

        if (!userState.current) {
            d1.textContent = 0;
            d2.textContent = 0;
            d3.textContent = 0;
            d4.textContent = 0;
            return;
        }
        const data = userState.users[userState.current] || {
            days: 0, streak: 0, words: 0, writings: 0
        };
        d1.textContent = data.days;
        d2.textContent = data.streak;
        d3.textContent = data.words;
        d4.textContent = data.writings;
    }

    // ========= è©å½™æ¸²æŸ“ =========
    function renderVocab() {
        const vc = document.getElementById('vc');
        vc.innerHTML = '';
        vocabData.forEach(item => {
            const card = document.createElement('div');
            card.className = 'vocab-card';
            card.innerHTML = `
                <div class="vocab-word">${item.word}</div>
                <div class="vocab-pronunciation">${item.pronunciation}</div>
                <div class="vocab-meaning">${item.meaning}</div>
                <div class="vocab-example">${item.example}</div>
                <button class="play-btn" type="button">æ’­æ”¾ç™¼éŸ³ï¼ˆç¤ºæ„ï¼‰</button>
            `;
            vc.appendChild(card);
        });
    }

    // ========= æ–‡æ³•æ¸²æŸ“ =========
    function renderGrammar() {
        const gt = document.getElementById('gt');
        const gc = document.getElementById('gc');
        gt.innerHTML = '';
        gc.innerHTML = '';

        grammarData.forEach(section => {
            const titleDiv = document.createElement('div');
            titleDiv.textContent = section.topic;
            titleDiv.style.fontWeight = 'bold';
            titleDiv.style.color = '#A89968';
            titleDiv.style.marginBottom = '10px';
            gt.appendChild(titleDiv);

            section.questions.forEach((q, idx) => {
                const qDiv = document.createElement('div');
                qDiv.className = 'grammar-q';

                const optionsHtml = q.options.map((opt, i) => {
                    return `<button class="opt-btn" data-index="${i}" type="button">${opt}</button>`;
                }).join('');

                qDiv.innerHTML = `
                    <div class="q-text">Q${idx + 1}. ${q.question}</div>
                    <div class="options">${optionsHtml}</div>
                    <div class="explain">è§£èªªï¼š${q.explanation}</div>
                `;
                const btns = qDiv.querySelectorAll('.opt-btn');
                const explain = qDiv.querySelector('.explain');
                btns.forEach((btn, i) => {
                    btn.addEventListener('click', () => {
                        btns.forEach(b => b.classList.remove('correct'));
                        if (i === q.correct) {
                            btn.classList.add('correct');
                        }
                        explain.classList.add('show');
                    });
                });

                gc.appendChild(qDiv);
            });
        });
    }

    // ========= å¯«ä½œæ¸²æŸ“ =========
    function renderWriting(levelIndex) {
        const wc = document.getElementById('wc');
        wc.innerHTML = '';

        if (levelIndex === 0) {
            const tasks = writingExercisesBank.level1;
            tasks.forEach((task, idx) => {
                const div = document.createElement('div');
                div.className = 'writing-ex';
                div.innerHTML = `
                    <div class="ex-label">ç´šåˆ¥1ï¼šå¥å­çµ„åˆ</div>
                    <div class="ex-content">${task.question}</div>
                    <div class="ex-hint">${task.hint}</div>
                    <textarea data-idx="${idx}" placeholder="åœ¨æ­¤è¼¸å…¥ä½ çš„è‹±æ–‡å¥å­..."></textarea>
                    <div class="word-count">ç›®å‰å­—æ•¸ï¼š<span>0</span> words</div>
                    <button class="submit-btn" type="button">æ¨™è¨˜ç‚ºå®Œæˆï¼ˆç¤ºæ„ï¼‰</button>
                    <div class="feedback">å·²æ¨™è¨˜å®Œæˆï¼å»ºè­°è«‹è€å¸«æˆ–åŒå­¸å¹«å¿™å›é¥‹å…§å®¹ã€‚</div>
                `;
                setupWritingItem(div);
                wc.appendChild(div);
            });
        } else if (levelIndex === 1) {
            const tasks = writingExercisesBank.level2;
            tasks.forEach((task, idx) => {
                const div = document.createElement('div');
                div.className = 'writing-ex';
                div.innerHTML = `
                    <div class="ex-label">ç´šåˆ¥2ï¼šæ®µè½å¯«ä½œ</div>
                    <div class="ex-content">ä¸»é¡Œï¼š${task.topic}</div>
                    <div class="ex-hint">é—œéµè©ï¼š${task.keywords}</div>
                    <textarea data-idx="${idx}" placeholder="ä¾ä¸»é¡Œå¯«å‡ºç´„ 3â€“5 å¥è‹±æ–‡æ®µè½..."></textarea>
                    <div class="word-count">ç›®å‰å­—æ•¸ï¼š<span>0</span> words</div>
                    <button class="submit-btn" type="button">æ¨™è¨˜ç‚ºå®Œæˆï¼ˆç¤ºæ„ï¼‰</button>
                    <div class="feedback">å·²æ¨™è¨˜å®Œæˆï¼å»ºè­°è«‹è€å¸«æˆ–åŒå­¸å¹«å¿™å›é¥‹å…§å®¹ã€‚</div>
                `;
                setupWritingItem(div);
                wc.appendChild(div);
            });
        } else if (levelIndex === 2) {
            const tasks = writingExercisesBank.level3;
            tasks.forEach((task, idx) => {
                const div = document.createElement('div');
                div.className = 'writing-ex';
                div.innerHTML = `
                    <div class="ex-label">ç´šåˆ¥3ï¼šçŸ­æ–‡å‰µä½œ</div>
                    <div class="ex-content">å¯«ä½œä¸»é¡Œï¼š${task.topic}</div>
                    <div class="ex-hint">ç›®æ¨™ 150â€“200 å­—ï¼Œå¯åˆ†ç‚ºé–‹é ­ã€ç™¼å±•ã€çµå°¾ä¸‰éƒ¨åˆ†ã€‚</div>
                    <textarea data-idx="${idx}" placeholder="åœ¨æ­¤æ’°å¯«å®Œæ•´è‹±æ–‡çŸ­æ–‡..."></textarea>
                    <div class="word-count">ç›®å‰å­—æ•¸ï¼š<span>0</span> words</div>
                    <button class="submit-btn" type="button">æ¨™è¨˜ç‚ºå®Œæˆï¼ˆç¤ºæ„ï¼‰</button>
                    <div class="feedback">å·²æ¨™è¨˜å®Œæˆï¼å»ºè­°è«‹è€å¸«æˆ–åŒå­¸å¹«å¿™å›é¥‹å…§å®¹ã€‚</div>
                `;
                setupWritingItem(div);
                wc.appendChild(div);
            });
        }
    }

    function setupWritingItem(div) {
        const textarea = div.querySelector('textarea');
        const countSpan = div.querySelector('.word-count span');
        const btn = div.querySelector('.submit-btn');
        const feedback = div.querySelector('.feedback');

        textarea.addEventListener('input', () => {
            const text = textarea.value.trim();
            const words = text ? text.split(/\s+/).length : 0;
            countSpan.textContent = words;
        });

        btn.addEventListener('click', () => {
            feedback.classList.add('show');
            if (userState.current) {
                const user = userState.users[userState.current] || {
                    days: 0, streak: 0, words: 0, writings: 0
                };
                user.writings += 1;
                userState.users[userState.current] = user;
                saveUsers(userState);
                loadUserProgress();
            }
        });
    }

    // ========= Tab åˆ‡æ› =========
    function initWritingTabs() {
        const tabContainer = document.getElementById('wt');
        const tabs = tabContainer.querySelectorAll('.tab');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const index = parseInt(tab.getAttribute('data-index'), 10);
                renderWriting(index);
            });
        });
        renderWriting(0);
    }

    // ========= åˆå§‹åŒ– =========
    document.addEventListener('DOMContentLoaded', () => {
        updateCurrentUserDisplay();
        loadUserProgress();
        renderVocab();
        renderGrammar();
        initWritingTabs();
    });
</script>
</body>
</html>
